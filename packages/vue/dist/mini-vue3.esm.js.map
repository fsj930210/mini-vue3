{"version":3,"file":"mini-vue3.esm.js","sources":["../../runtime-core/src/component.ts","../../runtime-core/src/renderer.ts","../../runtime-core/src/vnode.ts","../../runtime-core/src/createApp.ts","../../runtime-core/src/h.ts","../../shared/src/index.ts","../../reactivity/src/dep.ts","../../reactivity/src/effect.ts","../../reactivity/src/baseHandler.ts","../../reactivity/src/reactive.ts","../../reactivity/src/ref.ts"],"sourcesContent":["export function createComponentInstance(vnode) {\n    const component = {\n        vnode,\n        type: vnode.type,\n    };\n    return component;\n}\nexport function setupComponent(instance) {\n    setupStatefulComponent(instance);\n}\nfunction setupStatefulComponent(instance) {\n    const Component = instance.type;\n    const { setup } = Component;\n    if (setup) {\n        const setupResult = setup();\n        handleSetupResult(instance, setupResult);\n    }\n}\nfunction handleSetupResult(instance, setupResult) {\n    if (typeof setupResult === 'object') {\n        instance.setupState = setupResult;\n    }\n    finishComponentSetup(instance);\n}\nfunction finishComponentSetup(instance) {\n    const Component = instance.type;\n    if (Component.render) {\n        instance.render = Component.render;\n    }\n}\n//# sourceMappingURL=component.js.map","import { createComponentInstance, setupComponent } from './component';\nexport function render(vnode, container) {\n    patch(vnode, container);\n}\nfunction patch(vnode, container) {\n    processComponent(vnode, container);\n}\nfunction processComponent(vnode, container) {\n    mountComponent(vnode, container);\n}\nfunction mountComponent(vnode, container) {\n    const instance = createComponentInstance(vnode);\n    setupComponent(instance);\n    setupRenderEffect(instance, container);\n}\nfunction setupRenderEffect(instance, container) {\n    const subTree = instance.render();\n    patch(subTree, container);\n}\n//# sourceMappingURL=renderer.js.map","export function createVNode(type, props, children) {\n    const vnode = {\n        type,\n        props,\n        children,\n    };\n    return vnode;\n}\n//# sourceMappingURL=vnode.js.map","import { render } from './renderer';\nimport { createVNode } from './vnode';\nexport function createApp(rootComponent) {\n    return {\n        mount(rootContainer) {\n            const vnode = createVNode(rootComponent);\n            render(vnode, rootContainer);\n        },\n    };\n}\n//# sourceMappingURL=createApp.js.map","import { createVNode } from './vnode';\nexport function h(type, props, children) {\n    const vnode = createVNode(type, props, children);\n    return vnode;\n}\n//# sourceMappingURL=h.js.map","export const extend = Object.assign;\nexport function isObject(value) {\n    return value !== null && typeof value === 'object';\n}\nexport function hasChanged(value, oldValue) {\n    return !Object.is(value, oldValue);\n}\n//# sourceMappingURL=index.js.map","export function createDep(effects) {\n    const dep = new Set(effects);\n    return dep;\n}\n//# sourceMappingURL=dep.js.map","import { extend } from '@mini-vue3/shared';\nimport { createDep } from './dep';\nconst targetMap = new WeakMap();\nlet activeEffect;\nlet shouldTrack;\nexport class ReactiveEffect {\n    constructor(_fn, scheduler) {\n        this._fn = _fn;\n        this.scheduler = scheduler;\n        this.active = true;\n        this.deps = [];\n        console.log('创建 ReactiveEffect 对象');\n    }\n    run() {\n        if (!this.active) {\n            return this._fn();\n        }\n        shouldTrack = true;\n        activeEffect = this;\n        const res = this._fn();\n        shouldTrack = false;\n        return res;\n    }\n    stop() {\n        var _a;\n        if (this.active) {\n            cleanupEffect(this);\n            (_a = this.onStop) === null || _a === void 0 ? void 0 : _a.call(this);\n            this.active = false;\n        }\n    }\n}\nfunction cleanupEffect(effect) {\n    effect.deps.forEach((dep) => {\n        dep.delete(effect);\n    });\n    effect.deps.length = 0;\n}\nexport function isTracking() {\n    return shouldTrack && activeEffect !== undefined;\n}\nexport function effect(fn, options = {}) {\n    const _effect = new ReactiveEffect(fn);\n    extend(_effect, options);\n    _effect.run();\n    const runner = _effect.run.bind(_effect);\n    runner.effect = _effect;\n    return runner;\n}\nexport function trackEffects(dep) {\n    if (!dep.has(activeEffect)) {\n        dep.add(activeEffect);\n        activeEffect.deps.push(dep);\n    }\n}\nexport function track(target, key) {\n    if (!isTracking())\n        return;\n    let depsMap = targetMap.get(target);\n    if (!depsMap) {\n        depsMap = new Map();\n        targetMap.set(target, depsMap);\n    }\n    let dep = depsMap.get(key);\n    if (!dep) {\n        dep = createDep();\n        depsMap.set(key, dep);\n    }\n    trackEffects(dep);\n}\nexport function triggerEffects(dep) {\n    for (const effect of dep) {\n        if (effect.scheduler) {\n            effect.scheduler();\n        }\n        else {\n            effect.run();\n        }\n    }\n}\nexport function trigger(target, key) {\n    const depsMap = targetMap.get(target);\n    const deps = depsMap.get(key);\n    triggerEffects(deps);\n}\nexport function stop(runner) {\n    runner.effect.stop();\n}\n//# sourceMappingURL=effect.js.map","import { extend, isObject } from \"@mini-vue3/shared\";\nimport { track, trigger } from \"./effect\";\nimport { reactive, readonly } from \"./reactive\";\nconst get = createGetter();\nconst set = createSetter();\nconst readonlyGet = createGetter(true);\nconst shallowReadonlyGet = createGetter(true, true);\nfunction createGetter(isReadonly = false, shallow = false) {\n    return function get(target, key) {\n        if (key === \"__v_isReactive\") {\n            return !isReadonly;\n        }\n        else if (key === \"__v_isReadonly\") {\n            return isReadonly;\n        }\n        const res = Reflect.get(target, key);\n        if (shallow) {\n            return res;\n        }\n        if (isObject(res)) {\n            return isReadonly ? readonly(res) : reactive(res);\n        }\n        if (!isReadonly) {\n            track(target, key);\n        }\n        return res;\n    };\n}\nfunction createSetter() {\n    return function set(target, key, newValue) {\n        const res = Reflect.set(target, key, newValue);\n        trigger(target, key);\n        return res;\n    };\n}\nexport const readonlyHandlers = {\n    get: readonlyGet,\n    set(target, key) {\n        console.warn(`Set operation on key \"${String(key)}\" failed: target is readonly.`, target);\n        return true;\n    }\n};\nexport const mutableHandlers = {\n    get,\n    set,\n};\nexport const shallowReadonlyHandlers = extend({}, readonlyHandlers, {\n    get: shallowReadonlyGet,\n});\n//# sourceMappingURL=baseHandler.js.map","import { mutableHandlers, readonlyHandlers, shallowReadonlyHandlers } from './baseHandler';\nexport var ReactiveFlags;\n(function (ReactiveFlags) {\n    ReactiveFlags[\"IS_REACTIVE\"] = \"__v_isReactive\";\n    ReactiveFlags[\"IS_READONLY\"] = \"__v_isReadonly\";\n    ReactiveFlags[\"RAW\"] = \"__v_raw\";\n})(ReactiveFlags || (ReactiveFlags = {}));\nfunction createReactiveObject(raw, baseHandler) {\n    return new Proxy(raw, baseHandler);\n}\nexport function reactive(raw) {\n    return createReactiveObject(raw, mutableHandlers);\n}\nexport function readonly(raw) {\n    return createReactiveObject(raw, readonlyHandlers);\n}\nexport function shallowReadonly(raw) {\n    return createReactiveObject(raw, shallowReadonlyHandlers);\n}\nexport function isReadonly(value) {\n    return !!value[\"__v_isReadonly\"];\n}\nexport function isReactive(value) {\n    return !!value[\"__v_isReactive\"];\n}\nexport function isProxy(value) {\n    return isReactive(value) || isReadonly(value);\n}\n//# sourceMappingURL=reactive.js.map","import { hasChanged, isObject } from '@mini-vue3/shared';\nimport { isTracking, trackEffects, triggerEffects } from './effect';\nimport { reactive } from './reactive';\nimport { createDep } from './dep';\nclass RefImpl {\n    constructor(_value) {\n        this.__v_isRef = true;\n        this._rawValue = _value;\n        this._value = convert(_value);\n        this.dep = createDep();\n    }\n    get value() {\n        trackRefValue(this);\n        return this._value;\n    }\n    set value(newValue) {\n        if (hasChanged(newValue, this._rawValue)) {\n            this._rawValue = newValue;\n            this._value = convert(newValue);\n            triggerRefValue(this);\n        }\n    }\n}\nfunction convert(value) {\n    return isObject(value) ? reactive(value) : value;\n}\nexport function trackRefValue(ref) {\n    if (isTracking()) {\n        trackEffects(ref.dep);\n    }\n}\nexport function triggerRefValue(ref) {\n    triggerEffects(ref.dep);\n}\nexport function ref(value) {\n    const refImpl = new RefImpl(value);\n    return refImpl;\n}\nexport function isRef(ref) {\n    return !!ref.__v_isRef;\n}\nexport function unRef(ref) {\n    return isRef(ref) ? ref.value : ref;\n}\nexport function proxyRefs(objectWithRefs) {\n    return new Proxy(objectWithRefs, {\n        get(target, key) {\n            return unRef(Reflect.get(target, key));\n        },\n        set(target, key, newValue) {\n            const oldValue = target[key];\n            if (isRef(oldValue) && !isRef(newValue)) {\n                return (target[key].value = newValue);\n            }\n            else {\n                return Reflect.set(target, key, newValue);\n            }\n        },\n    });\n}\n//# sourceMappingURL=ref.js.map"],"names":[],"mappings":"AAAO,SAAS,uBAAuB,CAAC,KAAK,EAAE;AAC/C,IAAI,MAAM,SAAS,GAAG;AACtB,QAAQ,KAAK;AACb,QAAQ,IAAI,EAAE,KAAK,CAAC,IAAI;AACxB,KAAK,CAAC;AACN,IAAI,OAAO,SAAS,CAAC;AACrB,CAAC;AACM,SAAS,cAAc,CAAC,QAAQ,EAAE;AACzC,IAAI,sBAAsB,CAAC,QAAQ,CAAC,CAAC;AACrC,CAAC;AACD,SAAS,sBAAsB,CAAC,QAAQ,EAAE;AAC1C,IAAI,MAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC;AACpC,IAAI,MAAM,EAAE,KAAK,EAAE,GAAG,SAAS,CAAC;AAChC,IAAI,IAAI,KAAK,EAAE;AACf,QAAQ,MAAM,WAAW,GAAG,KAAK,EAAE,CAAC;AACpC,QAAQ,iBAAiB,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAC;AACjD,KAAK;AACL,CAAC;AACD,SAAS,iBAAiB,CAAC,QAAQ,EAAE,WAAW,EAAE;AAClD,IAAI,IAAI,OAAO,WAAW,KAAK,QAAQ,EAAE;AACzC,QAAQ,QAAQ,CAAC,UAAU,GAAG,WAAW,CAAC;AAC1C,KAAK;AACL,IAAI,oBAAoB,CAAC,QAAQ,CAAC,CAAC;AACnC,CAAC;AACD,SAAS,oBAAoB,CAAC,QAAQ,EAAE;AACxC,IAAI,MAAM,SAAS,GAAG,QAAQ,CAAC,IAAI,CAAC;AACpC,IAAI,IAAI,SAAS,CAAC,MAAM,EAAE;AAC1B,QAAQ,QAAQ,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;AAC3C,KAAK;AACL;;AC5BO,SAAS,MAAM,CAAC,KAAK,EAAE,SAAS,EAAE;AACzC,IAAI,KAAK,CAAC,KAAgB,CAAC,CAAC;AAC5B,CAAC;AACD,SAAS,KAAK,CAAC,KAAK,EAAE,SAAS,EAAE;AACjC,IAAI,gBAAgB,CAAC,KAAgB,CAAC,CAAC;AACvC,CAAC;AACD,SAAS,gBAAgB,CAAC,KAAK,EAAE,SAAS,EAAE;AAC5C,IAAI,cAAc,CAAC,KAAgB,CAAC,CAAC;AACrC,CAAC;AACD,SAAS,cAAc,CAAC,KAAK,EAAE,SAAS,EAAE;AAC1C,IAAI,MAAM,QAAQ,GAAG,uBAAuB,CAAC,KAAK,CAAC,CAAC;AACpD,IAAI,cAAc,CAAC,QAAQ,CAAC,CAAC;AAC7B,IAAI,iBAAiB,CAAC,QAAmB,CAAC,CAAC;AAC3C,CAAC;AACD,SAAS,iBAAiB,CAAC,QAAQ,EAAE,SAAS,EAAE;AAChD,IAAI,MAAM,OAAO,GAAG,QAAQ,CAAC,MAAM,EAAE,CAAC;AACtC,IAAI,KAAK,CAAC,OAAkB,CAAC,CAAC;AAC9B;;AClBO,SAAS,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE;AACnD,IAAI,MAAM,KAAK,GAAG;AAClB,QAAQ,IAAI;AACZ,QAAQ,KAAK;AACb,QAAQ,QAAQ;AAChB,KAAK,CAAC;AACN,IAAI,OAAO,KAAK,CAAC;AACjB;;ACLO,SAAS,SAAS,CAAC,aAAa,EAAE;AACzC,IAAI,OAAO;AACX,QAAQ,KAAK,CAAC,aAAa,EAAE;AAC7B,YAAY,MAAM,KAAK,GAAG,WAAW,CAAC,aAAa,CAAC,CAAC;AACrD,YAAY,MAAM,CAAC,KAAoB,CAAC,CAAC;AACzC,SAAS;AACT,KAAK,CAAC;AACN;;ACRO,SAAS,CAAC,CAAC,IAAI,EAAE,KAAK,EAAE,QAAQ,EAAE;AACzC,IAAI,MAAM,KAAK,GAAG,WAAW,CAAC,IAAI,EAAE,KAAK,EAAE,QAAQ,CAAC,CAAC;AACrD,IAAI,OAAO,KAAK,CAAC;AACjB;;ACJO,MAAM,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC;AAC7B,SAAS,QAAQ,CAAC,KAAK,EAAE;AAChC,IAAI,OAAO,KAAK,KAAK,IAAI,IAAI,OAAO,KAAK,KAAK,QAAQ,CAAC;AACvD,CAAC;AACM,SAAS,UAAU,CAAC,KAAK,EAAE,QAAQ,EAAE;AAC5C,IAAI,OAAO,CAAC,MAAM,CAAC,EAAE,CAAC,KAAK,EAAE,QAAQ,CAAC,CAAC;AACvC;;ACNO,SAAS,SAAS,CAAC,OAAO,EAAE;AACnC,IAAI,MAAM,GAAG,GAAG,IAAI,GAAG,CAAC,OAAO,CAAC,CAAC;AACjC,IAAI,OAAO,GAAG,CAAC;AACf;;ACDA,MAAM,SAAS,GAAG,IAAI,OAAO,EAAE,CAAC;AAoEzB,SAAS,cAAc,CAAC,GAAG,EAAE;AACpC,IAAI,KAAK,MAAM,MAAM,IAAI,GAAG,EAAE;AAC9B,QAAQ,IAAI,MAAM,CAAC,SAAS,EAAE;AAC9B,YAAY,MAAM,CAAC,SAAS,EAAE,CAAC;AAC/B,SAAS;AACT,aAAa;AACb,YAAY,MAAM,CAAC,GAAG,EAAE,CAAC;AACzB,SAAS;AACT,KAAK;AACL,CAAC;AACM,SAAS,OAAO,CAAC,MAAM,EAAE,GAAG,EAAE;AACrC,IAAI,MAAM,OAAO,GAAG,SAAS,CAAC,GAAG,CAAC,MAAM,CAAC,CAAC;AAC1C,IAAI,MAAM,IAAI,GAAG,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAClC,IAAI,cAAc,CAAC,IAAI,CAAC,CAAC;AACzB;;ACjFA,MAAM,GAAG,GAAG,YAAY,EAAE,CAAC;AAC3B,MAAM,GAAG,GAAG,YAAY,EAAE,CAAC;AAC3B,MAAM,WAAW,GAAG,YAAY,CAAC,IAAI,CAAC,CAAC;AACvC,MAAM,kBAAkB,GAAG,YAAY,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;AACpD,SAAS,YAAY,CAAC,UAAU,GAAG,KAAK,EAAE,OAAO,GAAG,KAAK,EAAE;AAC3D,IAAI,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE;AACrC,QAAQ,IAAI,GAAG,KAAK,gBAAgB,EAAE;AACtC,YAAY,OAAO,CAAC,UAAU,CAAC;AAC/B,SAAS;AACT,aAAa,IAAI,GAAG,KAAK,gBAAgB,EAAE;AAC3C,YAAY,OAAO,UAAU,CAAC;AAC9B,SAAS;AACT,QAAQ,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;AAC7C,QAAQ,IAAI,OAAO,EAAE;AACrB,YAAY,OAAO,GAAG,CAAC;AACvB,SAAS;AACT,QAAQ,IAAI,QAAQ,CAAC,GAAG,CAAC,EAAE;AAC3B,YAAY,OAAO,UAAU,GAAG,QAAQ,CAAC,GAAG,CAAC,GAAG,QAAQ,CAAC,GAAG,CAAC,CAAC;AAC9D,SAAS;AAIT,QAAQ,OAAO,GAAG,CAAC;AACnB,KAAK,CAAC;AACN,CAAC;AACD,SAAS,YAAY,GAAG;AACxB,IAAI,OAAO,SAAS,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,EAAE;AAC/C,QAAQ,MAAM,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE,QAAQ,CAAC,CAAC;AACvD,QAAQ,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;AAC7B,QAAQ,OAAO,GAAG,CAAC;AACnB,KAAK,CAAC;AACN,CAAC;AACM,MAAM,gBAAgB,GAAG;AAChC,IAAI,GAAG,EAAE,WAAW;AACpB,IAAI,GAAG,CAAC,MAAM,EAAE,GAAG,EAAE;AACrB,QAAQ,OAAO,CAAC,IAAI,CAAC,CAAC,sBAAsB,EAAE,MAAM,CAAC,GAAG,CAAC,CAAC,6BAA6B,CAAC,EAAE,MAAM,CAAC,CAAC;AAClG,QAAQ,OAAO,IAAI,CAAC;AACpB,KAAK;AACL,CAAC,CAAC;AACK,MAAM,eAAe,GAAG;AAC/B,IAAI,GAAG;AACP,IAAI,GAAG;AACP,CAAC,CAAC;AACqC,MAAM,CAAC,EAAE,EAAE,gBAAgB,EAAE;AACpE,IAAI,GAAG,EAAE,kBAAkB;AAC3B,CAAC;;AC/CM,IAAI,aAAa,CAAC;AACzB,CAAC,UAAU,aAAa,EAAE;AAC1B,IAAI,aAAa,CAAC,aAAa,CAAC,GAAG,gBAAgB,CAAC;AACpD,IAAI,aAAa,CAAC,aAAa,CAAC,GAAG,gBAAgB,CAAC;AACpD,IAAI,aAAa,CAAC,KAAK,CAAC,GAAG,SAAS,CAAC;AACrC,CAAC,EAAE,aAAa,KAAK,aAAa,GAAG,EAAE,CAAC,CAAC,CAAC;AAC1C,SAAS,oBAAoB,CAAC,GAAG,EAAE,WAAW,EAAE;AAChD,IAAI,OAAO,IAAI,KAAK,CAAC,GAAG,EAAE,WAAW,CAAC,CAAC;AACvC,CAAC;AACM,SAAS,QAAQ,CAAC,GAAG,EAAE;AAC9B,IAAI,OAAO,oBAAoB,CAAC,GAAG,EAAE,eAAe,CAAC,CAAC;AACtD,CAAC;AACM,SAAS,QAAQ,CAAC,GAAG,EAAE;AAC9B,IAAI,OAAO,oBAAoB,CAAC,GAAG,EAAE,gBAAgB,CAAC,CAAC;AACvD;;ACXA,MAAM,OAAO,CAAC;AACd,IAAI,WAAW,CAAC,MAAM,EAAE;AACxB,QAAQ,IAAI,CAAC,SAAS,GAAG,IAAI,CAAC;AAC9B,QAAQ,IAAI,CAAC,SAAS,GAAG,MAAM,CAAC;AAChC,QAAQ,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,MAAM,CAAC,CAAC;AACtC,QAAQ,IAAI,CAAC,GAAG,GAAG,SAAS,EAAE,CAAC;AAC/B,KAAK;AACL,IAAI,IAAI,KAAK,GAAG;AAEhB,QAAQ,OAAO,IAAI,CAAC,MAAM,CAAC;AAC3B,KAAK;AACL,IAAI,IAAI,KAAK,CAAC,QAAQ,EAAE;AACxB,QAAQ,IAAI,UAAU,CAAC,QAAQ,EAAE,IAAI,CAAC,SAAS,CAAC,EAAE;AAClD,YAAY,IAAI,CAAC,SAAS,GAAG,QAAQ,CAAC;AACtC,YAAY,IAAI,CAAC,MAAM,GAAG,OAAO,CAAC,QAAQ,CAAC,CAAC;AAC5C,YAAY,eAAe,CAAC,IAAI,CAAC,CAAC;AAClC,SAAS;AACT,KAAK;AACL,CAAC;AACD,SAAS,OAAO,CAAC,KAAK,EAAE;AACxB,IAAI,OAAO,QAAQ,CAAC,KAAK,CAAC,GAAG,QAAQ,CAAC,KAAK,CAAC,GAAG,KAAK,CAAC;AACrD,CAAC;AAMM,SAAS,eAAe,CAAC,GAAG,EAAE;AACrC,IAAI,cAAc,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;AAC5B,CAAC;AACM,SAAS,GAAG,CAAC,KAAK,EAAE;AAC3B,IAAI,MAAM,OAAO,GAAG,IAAI,OAAO,CAAC,KAAK,CAAC,CAAC;AACvC,IAAI,OAAO,OAAO,CAAC;AACnB;;;;"}